<template>
  <div  class="w-full" v-if="loading">
<div class="p-1 space-y-4">


 <div class="w-full p-4 border border-gray-300 rounded-lg">
<div class="h-4 w-24 bg-gray-300 rounded animate-pulse"></div>
<div class="mt-2 flex items-center gap-2">
<div class="h-4 w-40 bg-gray-300 rounded animate-pulse"></div>
<div class="h-6 w-6 bg-gray-300 rounded animate-pulse"></div>
</div>
</div>


<!-- Table Skeleton -->

<div class="border border-gray-200 rounded-lg ">

 <div class="h-20   bg-white animate-pulse rounded-lg flex gap-2 justify-end items-center py-5 p-3">
 <div class="h-12 w-96 bg-gray-200 animate-pulse rounded"></div>
 <div class="h-12 w-8 bg-gray-200 animate-pulse rounded"></div>
 <div class="h-12 w-8 bg-gray-200 animate-pulse rounded"></div>
</div>

   <div class="grid grid-cols-7 bg-gray-100 p-3 font-semibold">
       <div class="h-8 w-20 bg-gray-200 animate-pulse rounded"></div>
       <div class="h-8 w-20 bg-gray-200 animate-pulse rounded"></div>
       <div class="h-8 w-20 bg-gray-200 animate-pulse rounded"></div>
       <div class="h-8 w-20 bg-gray-200 animate-pulse rounded"></div>
       <div class="h-8 w-20 bg-gray-200 animate-pulse rounded"></div>
       <div class="h-8 w-20 bg-gray-200 animate-pulse rounded"></div>
       <div class="h-8 w-20 bg-gray-200 animate-pulse rounded"></div>
   </div>

   <!-- Table Rows -->
   <div class="divide-y divide-gray-200">
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       <div class="grid grid-cols-7 p-3 animate-pulse">
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
           <div class="h-6 w-20 bg-gray-200 rounded"></div>
       </div>
       
   </div>
</div>

<!-- Pagination Skeleton -->
<div class="flex justify-center space-x-2">
   <div class="h-8 w-8 bg-gray-200 animate-pulse rounded-full"></div>
   <div class="h-8 w-8 bg-gray-200 animate-pulse rounded-full"></div>
   <div class="h-8 w-8 bg-gray-200 animate-pulse rounded-full"></div>
</div>
</div>
</div>


<div class="w-full p-1" v-if="content">
   <div class="w-full p-1 flex gap-2 items-end" >
<div>
 <div class="text-slate-500">Statement For {{ rangetext }} </div>
 <div class="text-black-500"><span>{{ startdate }}</span> To <span>{{ enddate }}</span></div>
</div>
 <div>
   <Popover class="relative">
     <PopoverButton class="inline-flex items-center gap-x-1 text-sm/6 font-semibold outline-none text-slate-500 border rounded-lg p-1 hover:bg-indigo-50">

       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
         stroke="currentColor" class="w-6 h-6">
         <path stroke-linecap="round" stroke-linejoin="round"
           d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
       </svg>

     </PopoverButton>

     <transition  enter-active-class="transition ease-out duration-200" enter-from-class="opacity-0 translate-y-1" 
       enter-to-class="opacity-100 translate-y-0" leave-active-class="transition ease-in duration-150"
       leave-from-class="opacity-100 translate-y-0" leave-to-class="opacity-0 translate-y-1">
       <PopoverPanel  class="absolute left z-10 mt-2 flex w-screen max-w-max -translate-x-1/2 px-4">
         <div
           class="w-screen max-w-md flex-auto overflow-hidden rounded-3xl bg-white text-sm/6 shadow-lg ring-1 ring-gray-900/5">
           <div class="p-4">
             <span class="text-lg"><i class="pi pi-clock"></i> Frequently used time period</span>
             <div class="w-full p-1 flex gap-2 pl-5">
               <button type="button" @click="filtereddata('days_7', close)" :class="{'bg-indigo-600 text-white': activedata === 'days_7', 'hover:bg-indigo-50 hover:text-black': activedata == 'days_7'}"
                 class="rounded-md  px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-indigo-50 hover:text-black-500">
                 7 Days</button>
               <button type="button"  @click="filtereddata('days_15', close)" :class="{'bg-indigo-600 text-white': activedata === 'days_15', 'hover:bg-indigo-50 hover:text-black': activedata == 'days_15'}"
                 class="rounded-md   px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-indigo-50 hover:text-black-500">15
                 Days</button>
               <button type="button"  @click="filtereddata('month_1', close)" :class="{'bg-indigo-600 text-white': activedata === 'month_1', 'hover:bg-indigo-50 hover:text-black': activedata == 'month_1'}"
                 class="rounded-md  px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-indigo-50 hover:text-black-500">1
                 Month</button>
               <button type="button"  @click="filtereddata('months_3', close)" :class="{'bg-indigo-600 text-white': activedata === 'months_3', 'hover:bg-indigo-50 hover:text-black': activedata == 'months_3'}"
                 class="rounded-md  px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-indigo-50 hover:text-black-500">3
                 Months</button>
             </div>

             <div class="mt-3">
         <span class="text-lg "><i class="pi pi-calendar"></i> Date Range Filter</span>
         <div class="flex justify-center items-center gap-2">
           <div class="w-48">
               <span>Start Date</span><br>
               <DatePicker  v-model="start" dateFormat="dd-mm-yy" showIcon />
           </div>
           <span>To</span>
           <div class="w-48">
               <span>End Date</span><br>
               <DatePicker v-model="end" dateFormat="dd-mm-yy" showIcon />
           </div>
       </div>
        </div>
       <div class="w-full flex justify-start mt-2">
           <button @click="filtereddata('daterangefilter', close)"
class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm ring-1 ring-inset ring-gray-300 
      hover:bg-indigo-50 hover:text-black">
Apply filter
</button>

       </div>
           </div>

         </div>
       </PopoverPanel>
     </transition>
   </Popover>
 </div>

</div>
</div>
<div class="w-full p-1 mt-2" >
   
</div>

<div class="card">
   <DataTable ref="dt" v-model:filters="filters" :value="datarows" paginator :rows="10" removableSort dataKey="id"
   filterDisplay="menu" :loading="loading" :globalFilterFields="['stockname', 'quantity']">
   <template #paginatorstart>
           <span>No of Rows {{ noofrows }}</span>
       </template>
   <template #header>
     <div class="flex justify-end gap-2 items-center">

       <IconField>
         <InputIcon>
           <i class="pi pi-search" />
         </InputIcon>
         <InputText v-model="filters['global'].value" placeholder="Search stock and company..." />
       </IconField>

       <MultiSelect v-model="selectedColumns" :options="columns" optionLabel="header"
         @change="updateVisibleColumns" display="template" :showToggleAll="false" :dropdownIcon="null"
         class="p-0 text-white ml-2 " style="width: 42px; height: 34px; ">
         <template #dropdownicon >
          
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
             class="w-6 h-6 text-slate-500">
             <path fill-rule="evenodd"
               d="M1.5 5.625c0-1.036.84-1.875 1.875-1.875h17.25c1.035 0 1.875.84 1.875 1.875v12.75c0 1.035-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 18.375V5.625ZM21 9.375A.375.375 0 0 0 20.625 9h-7.5a.375.375 0 0 0-.375.375v1.5c0 .207.168.375.375.375h7.5a.375.375 0 0 0 .375-.375v-1.5Zm0 3.75a.375.375 0 0 0-.375-.375h-7.5a.375.375 0 0 0-.375.375v1.5c0 .207.168.375.375.375h7.5a.375.375 0 0 0 .375-.375v-1.5Zm0 3.75a.375.375 0 0 0-.375-.375h-7.5a.375.375 0 0 0-.375.375v1.5c0 .207.168.375.375.375h7.5a.375.375 0 0 0 .375-.375v-1.5ZM10.875 18.75a.375.375 0 0 0 .375-.375v-1.5a.375.375 0 0 0-.375-.375h-7.5a.375.375 0 0 0-.375.375v1.5c0 .207.168.375.375.375h7.5ZM3.375 15h7.5a.375.375 0 0 0 .375-.375v-1.5a.375.375 0 0 0-.375-.375h-7.5a.375.375 0 0 0-.375.375v1.5c0 .207.168.375.375.375Zm0-3.75h7.5a.375.375 0 0 0 .375-.375v-1.5A.375.375 0 0 0 10.875 9h-7.5A.375.375 0 0 0 3 9.375v1.5c0 .207.168.375.375.375Z"
               clip-rule="evenodd" />
           </svg>
           
         </template>
         <template #footer v-if="showReset">
         <div class="p-2 w-full flex justify-center">
           <button type="button"  @click="resetColumns"  class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm ring-1 ring-inset ring-gray-300 
           hover:bg-indigo-50 hover:text-black">Reset</button>
         </div>

          
         </template>
       </MultiSelect>
      
       <button type="button" @click="exportCSV($event)"
         class="rounded-md ml-2  px-1 py-1 text-sm font-semibold text-slate-500  border-2 hover:bg-indigo-50"><svg
           xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
           <path fill-rule="evenodd"
             d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-.53 14.03a.75.75 0 0 0 1.06 0l3-3a.75.75 0 1 0-1.06-1.06l-1.72 1.72V8.25a.75.75 0 0 0-1.5 0v5.69l-1.72-1.72a.75.75 0 0 0-1.06 1.06l3 3Z"
             clip-rule="evenodd" />
         </svg>
       </button>
     </div>
   </template>
   <template #empty> No customers found. </template>
   <template #loading> Loading customers data. Please wait. </template>

   <Column class="cursor-pointer" v-if="visibleColumns.includes('stockname')" sortable field="stockname"
     header="Stockname">
     <template #body="{ data }">
      <span @click="rightcanva(data)">{{ data.stockname }}</span>
     </template>
     <template #filter="{ filterModel }">
       <InputText v-model="filterModel.value" type="text" placeholder="Search by name" />
     </template>
   </Column>
   <Column class="cursor-pointer" v-if="visibleColumns.includes('quantity')" sortable field="quantity"header="Quantity"  :showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)"> {{ data.quantity }}</span>
     </template>
     <template #filter="{ filterModel }">
       <Slider v-model="filterModel.value" range class="m-4" :min="minQuantityValue" :max="maxQuantityValue"></Slider>
       <div class="flex items-center justify-between px-2">
     
         <span>{{ filterModel.value ? filterModel.value[0] : minQuantityValue }}</span>
         <span>{{ filterModel.value ? filterModel.value[1] : maxQuantityValue }}</span>
       </div>
     </template>
   </Column>

   <Column class="cursor-pointer"  v-if="visibleColumns.includes('date')"  sortable field="date" header="Date"  :showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)">{{ formatDatee(data.date) }}</span>
      
     </template>
     <template #filter="{ filterModel }">
       <DatePicker v-model="filters.date.constraints[0].value" dateFormat="dd-mm-yy" showIcon
         @update:modelValue="applyDateFilter" />
     </template>
   </Column>
   <Column class="cursor-pointer"  v-if="visibleColumns.includes('avgprice')"  sortable field="avgprice" header="Avgprice"  :showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)">{{ data.avgprice }}</span>
     </template>
     <template #filter="{ filterModel }">
       <Slider v-model="filterModel.value" range class="m-4" :min="minavgValue" :max="maxavgValue" ></Slider>
       <div class="flex items-center justify-between px-2">
         <span>{{ filterModel.value ? filterModel.value[0] : minavgValue }}</span>
         <span>{{ filterModel.value ? filterModel.value[1] : maxavgValue }}</span>
       </div>
     </template>
   </Column>
   <Column class="cursor-pointer"  v-if="visibleColumns.includes('ltp')"  sortable field="ltp" header="LTP"  :showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)"> {{ data.ltp }}</span>
     </template>
     <template #filter="{ filterModel }">
       <Slider v-model="filterModel.value" range class="m-4" :min="minltpValue" :max="maxltpValue"></Slider>
       <div class="flex items-center justify-between px-2">
         <span>{{ filterModel.value ? filterModel.value[0] : minltpValue }}</span>
         <span>{{ filterModel.value ? filterModel.value[1] : maxltpValue }}</span>
       </div>
     </template>
   </Column>
   <Column class="cursor-pointer"  v-if="visibleColumns.includes('invamt')" sortable field="invamt" header="INV"  :showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)">{{ data.invamt }}</span>
     </template>
     <template #filter="{ filterModel }">
       <Slider v-model="filterModel.value" range class="m-4" :min="mininvValue" :max="maxinvValue"></Slider>
       <div class="flex items-center justify-between px-2">
         <span>{{ filterModel.value ? filterModel.value[0] : mininvValue }}</span>
         <span>{{ filterModel.value ? filterModel.value[1] : maxinvValue }}</span>
       </div>
     </template>
   </Column>
   <Column class="cursor-pointer"  v-if="visibleColumns.includes('mktval')"  field="mktval" sortable header="Mktval":showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)">{{ data.mktval }}</span>
     </template>
     <template #filter="{ filterModel }">
       <Slider v-model="filterModel.value" range class="m-4" :min="minmktValue" :max="maxmktValue"></Slider>
       <div class="flex items-center justify-between px-2">
         <span>{{ filterModel.value ? filterModel.value[0] : minmktValue }}</span>
         <span>{{ filterModel.value ? filterModel.value[1] : maxmktValue }}</span>
       </div>
     </template>
   </Column>
   <Column class="cursor-pointer"  v-if="visibleColumns.includes('overall')" sortable field="overall"header="Overall"  :showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)">{{ data.overall }}</span>
     </template>
     <template #filter="{ filterModel }">
       <Slider v-model="filterModel.value" range class="m-4" :min="minoverValue" :max="maxoverValue"></Slider>
       <div class="flex items-center justify-between px-2">
         <span>{{ filterModel.value ? filterModel.value[0] : minoverValue }}</span>
         <span>{{ filterModel.value ? filterModel.value[1] : maxoverValue }}</span>
       </div>
     </template>
   </Column>
   <Column class="cursor-pointer"  v-if="visibleColumns.includes('days')"  sortable field="days" header="Days"  :showFilterOperator="false" :showFilterMatchModes="false">
     <template #body="{ data }">
       <span @click="rightcanva(data)"> {{ data.days }}</span>
     </template>
     <template #filter="{ filterModel }">
       <Slider v-model="filterModel.value" range class="m-4" :min="mindaysValue" :max="maxdaysValue"></Slider>
       <div class="flex items-center justify-between px-2">
         <span>{{ filterModel.value ? filterModel.value[0] : mindaysValue }}</span>
         <span>{{ filterModel.value ? filterModel.value[1] : maxdaysValue }}</span>
       </div>
     </template>
   </Column>

   </DataTable>
  
       
<Drawer v-model:visible="visibleRight" header="Stock Details" position="right" class="!w-90 md:!w-80 lg:!w-[80rem] wd" >


<hr>
<div class="w-full p-1 flex flex-col h-full justify-between" >
<div class="w-full flex wrap" >
<div class="w-2/3 p-1 b-1"  >
<Tabs value="0">
<TabList >
 <Tab value="0"><i class="pi pi-asterisk"></i> Activity</Tab>
 <Tab value="1"><i class="pi pi-envelope"></i> Emails</Tab>
 <Tab value="2"><i class="pi pi-comment"></i> Comments</Tab>
 <Tab value="3"><i class="pi pi-database"></i> Data</Tab>
 <Tab value="4"><i class="pi pi-list-check"></i> Tasks</Tab>
 <Tab value="5"><i class="pi pi-clipboard"></i> Notes</Tab>
 <Tab value="6"><i class="pi pi-paperclip"></i> Attachments</Tab>
</TabList>
<TabPanels>
<TabPanel value="0">
 Tab-0
</TabPanel>
<TabPanel value="1">
Tab-1
</TabPanel>
<TabPanel value="2">
 Tab-2
</TabPanel>
<TabPanel value="3">
Tab-3
</TabPanel>
<TabPanel value="4">
 Tab-4
</TabPanel>
<TabPanel value="5">
Tab-5
</TabPanel>
<TabPanel value="6">
Tab-6
</TabPanel>
</TabPanels>
</Tabs>


</div>
<div class="w-1/3 p-1 b-1" style="border-left: 1px solid gray;">
<p class="text-black-500 text-xl p-2 mt-3"><b>CRM-123H43</b></p>
<hr>

<div class="w-full flex justify-center items-center gap-3 p-2">
 <div class="rounded-full bg-slate-500 w-10 h-10"></div>
 <h1>{{ stockname }}</h1>
</div>
<hr>
<div class="w-full mt-2">
 
<Accordion value="0">
<AccordionPanel value="0">
<AccordionHeader>Details</AccordionHeader>
<AccordionContent>

 <div class="w-full  flex">
   <div class="w-full " ><span>Stock Name</span></div>
   <div class="w-full " ><span>{{stockname}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>Date</span></div>
   <div class="w-full " ><span>{{dateval}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>Quantity</span></div>
   <div class="w-full " ><span>{{quant}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>AVG Price</span></div>
   <div class="w-full " ><span>{{avg}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>LTP</span></div>
   <div class="w-full " ><span>{{ltp}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>INV Amount</span></div>
   <div class="w-full " ><span>{{invamt}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>MKT Value</span></div>
   <div class="w-full " ><span>{{mktval}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>Over All</span></div>
   <div class="w-full " ><span>{{overall}}</span></div>
 </div>
 <div class="w-full  flex">
   <div class="w-full " ><span>Days</span></div>
   <div class="w-full " ><span>{{days}}</span></div>
 </div>

  
</AccordionContent>
</AccordionPanel>
</Accordion>
</div>
</div>

</div>



<div class="w-full p-1 flex justify-center gap-2" >
<Button label="Proceed" severity="success" @click="proceedfun" raised />
<Button label="Cancel" severity="danger" @click="cancelfun" variant="outlined" />
</div> 
</div>
</Drawer>

</div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { Popover, PopoverButton, PopoverPanel } from '@headlessui/vue'
import { FilterMatchMode, FilterOperator } from '@primevue/core/api';

const loading=ref(true)
const content=ref(false)

const storedData = ref([]); 
const datarows=ref([])
const startdate = ref('0')
const enddate = ref('0')
const start = ref(null);
const end = ref(null);
const activedata=ref('days_7')
const rangetext=ref('')
const noofrows=ref(0)
const filters = ref();

const formatDatee = (dateString) => {
if (!dateString) return "";
const [year, month, day] = dateString.split("-");
return `${day}-${month}-${year.slice(-4)}`; // Convert yy-mm-dd to dd-mm-yy
};

const formatDater = (date) => {
return date.toLocaleDateString('en-GB').split('/').join('-'); // Format to dd-mm-yyyy
};
const minQuantityValue=ref('')
const maxQuantityValue=ref('')

const minavgValue=ref('')
const maxavgValue=ref('')

const minltpValue=ref('')
const maxltpValue=ref('')

const minmktValue=ref('')
const maxmktValue=ref('')

const mininvValue=ref('')
const maxinvValue=ref('')

const minoverValue=ref('')
const maxoverValue=ref('')

const mindaysValue=ref('')
const maxdaysValue=ref('')


const getdata = async () => {
try {
   const res = await fetch("/demo.json");
   if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
   const data = await res.json();
   
  
   storedData.value = [...data]; 
   filtereddata('days_7', close)
} catch (error) {
   console.error("Error:", error.message);
}
finally{
   loading.value=false
   content.value=true
}
};

const filtereddata= async (datefilterval, close)=>{
close()
if (datefilterval == 'days_7') {

console.log(filters.value)
rangetext.value='7 Days'
activedata.value='days_7'
const today = new Date();
const sevenDaysAgo = new Date();
sevenDaysAgo.setDate(today.getDate() - 6);
today.setHours(0, 0, 0, 0);
sevenDaysAgo.setHours(0, 0, 0, 0);
startdate.value = formatDater(sevenDaysAgo);
enddate.value = formatDater(today);

start.value = sevenDaysAgo;
end.value = today;
const filteredData = storedData.value.filter(item => {
   const itemDate = new Date(item.date);
   itemDate.setHours(0, 0, 0, 0); 
   return itemDate >= sevenDaysAgo && itemDate <= today;
});

datarows.value = filteredData; 
noofrows.value=filteredData.length
minQuantityValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.quantity)) : 0;
maxQuantityValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.quantity)) : 0;
minavgValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.avgprice)) : 0;
maxavgValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.avgprice)) : 0;
minltpValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.ltp)) : 0;
maxltpValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.ltp)) : 0;
mininvValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.invamt)) : 0;
maxinvValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.invamt)) : 0;
minmktValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.mktval)) : 0;
maxmktValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.mktval)) : 0;
minoverValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.overall)) : 0;
maxoverValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.overall)) : 0;
mindaysValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.days)) : 0;
maxdaysValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.days)) : 0;
    initFilters();
}

else if(datefilterval=='days_15'){
   rangetext.value='15 Days'
    activedata.value='days_15'
   const today = new Date();
   const fiteenDaysAgo = new Date();
   fiteenDaysAgo.setDate(today.getDate() - 14);
   today.setHours(0, 0, 0, 0);
   fiteenDaysAgo.setHours(0, 0, 0, 0);
   startdate.value = formatDater(fiteenDaysAgo);
   enddate.value = formatDater(today);

   start.value = fiteenDaysAgo;
   end.value = today;
   const filteredData = storedData.value.filter(item => {
       const itemDate = new Date(item.date);
       itemDate.setHours(0, 0, 0, 0); 
       return itemDate >= fiteenDaysAgo && itemDate <= today;
   });

   datarows.value = filteredData; 
   noofrows.value=filteredData.length
   minQuantityValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.quantity)) : 0;
maxQuantityValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.quantity)) : 0;
minavgValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.avgprice)) : 0;
maxavgValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.avgprice)) : 0;
minltpValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.ltp)) : 0;
maxltpValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.ltp)) : 0;
mininvValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.invamt)) : 0;
maxinvValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.invamt)) : 0;
minmktValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.mktval)) : 0;
maxmktValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.mktval)) : 0;
minoverValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.overall)) : 0;
maxoverValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.overall)) : 0;
mindaysValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.days)) : 0;
maxdaysValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.days)) : 0;
    initFilters();
 
}
else if(datefilterval=='month_1'){
   rangetext.value='1 Month'
   activedata.value='month_1'
   const today = new Date();
   const oneMonthAgo = new Date();
   oneMonthAgo.setMonth(today.getMonth() - 1);
   today.setHours(0, 0, 0, 0);
   oneMonthAgo.setHours(0, 0, 0, 0);
   startdate.value = formatDater(oneMonthAgo);
   enddate.value = formatDater(today);

   start.value = oneMonthAgo;
   end.value = today;
   const filteredData = storedData.value.filter(item => {
       const itemDate = new Date(item.date);
       itemDate.setHours(0, 0, 0, 0); 
       return itemDate >= oneMonthAgo && itemDate <= today;
   });

   datarows.value = filteredData;
   noofrows.value=filteredData.length
   minQuantityValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.quantity)) : 0;
maxQuantityValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.quantity)) : 0;
minavgValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.avgprice)) : 0;
maxavgValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.avgprice)) : 0;
minltpValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.ltp)) : 0;
maxltpValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.ltp)) : 0;
mininvValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.invamt)) : 0;
maxinvValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.invamt)) : 0;
minmktValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.mktval)) : 0;
maxmktValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.mktval)) : 0;
minoverValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.overall)) : 0;
maxoverValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.overall)) : 0;
mindaysValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.days)) : 0;
maxdaysValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.days)) : 0;
    initFilters();
}

else if(datefilterval=='months_3'){
   rangetext.value='3 Months'
    activedata.value='months_3'
   const today = new Date();
   const threeMonthsAgo = new Date();
   threeMonthsAgo.setMonth(today.getMonth() - 3); 
   today.setHours(0, 0, 0, 0);
   threeMonthsAgo.setHours(0, 0, 0, 0);

   startdate.value = formatDater(threeMonthsAgo);
   enddate.value = formatDater(today);

   start.value = threeMonthsAgo;
   end.value = today;
   const filteredData = storedData.value.filter(item => {
       const itemDate = new Date(item.date);
       itemDate.setHours(0, 0, 0, 0);
       return itemDate >= threeMonthsAgo && itemDate <= today;
   });

   datarows.value = filteredData; 
   noofrows.value=filteredData.length
   minQuantityValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.quantity)) : 0;
maxQuantityValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.quantity)) : 0;
minavgValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.avgprice)) : 0;
maxavgValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.avgprice)) : 0;
minltpValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.ltp)) : 0;
maxltpValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.ltp)) : 0;
mininvValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.invamt)) : 0;
maxinvValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.invamt)) : 0;
minmktValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.mktval)) : 0;
maxmktValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.mktval)) : 0;
minoverValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.overall)) : 0;
maxoverValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.overall)) : 0;
mindaysValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.days)) : 0;
maxdaysValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.days)) : 0;
    initFilters();
}
else if(datefilterval=='daterangefilter'){
   if (!start.value || !end.value) {
   console.error("Start or End date is missing!");
   return;
}

const formattedStart = new Date(start.value);
formattedStart.setHours(0, 0, 0, 0);
const formattedEnd = new Date(end.value);
formattedEnd.setHours(23, 59, 59, 999); 


if (formattedStart > formattedEnd) {
   console.error("Start date cannot be after end date!");
   return;
}

try {
   const res = await fetch("/peryear.json");
   if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
   
   const data = await res.json();
  
   startdate.value=formatDater(formattedStart)
   enddate.value=formatDater(formattedEnd)
   const filteredData = data.filter(item => {
       const itemDate = new Date(item.date); 
       return itemDate >= formattedStart && itemDate <= formattedEnd;
   });
   datarows.value = filteredData;
   noofrows.value=filteredData.length
   minQuantityValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.quantity)) : 0;
maxQuantityValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.quantity)) : 0;
minavgValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.avgprice)) : 0;
maxavgValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.avgprice)) : 0;
minltpValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.ltp)) : 0;
maxltpValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.ltp)) : 0;
mininvValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.invamt)) : 0;
maxinvValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.invamt)) : 0;
minmktValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.mktval)) : 0;
maxmktValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.mktval)) : 0;
minoverValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.overall)) : 0;
maxoverValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.overall)) : 0;
mindaysValue.value = filteredData.length > 0 ? Math.min(...filteredData.map((item) => item.days)) : 0;
maxdaysValue.value = filteredData.length > 0 ? Math.max(...filteredData.map((item) => item.days)) : 0;
    initFilters();
} catch (error) {
   console.error("Error:", error.message);
} finally {
 
}
close();
}

}

const initFilters = () => {

filters.value = {
global: { value: null, matchMode: FilterMatchMode.CONTAINS },
stockname: { operator: FilterOperator.AND, constraints: [{ value: null, matchMode: FilterMatchMode.STARTS_WITH }] },
quantity: { value: [minQuantityValue.value, maxQuantityValue.value], matchMode: FilterMatchMode.BETWEEN },
avgprice: { value:  [minavgValue.value, maxavgValue.value], matchMode: FilterMatchMode.BETWEEN },
ltp: { value:[minltpValue.value, maxltpValue.value] , matchMode: FilterMatchMode.BETWEEN },
invamt: { value:  [mininvValue.value, maxinvValue.value], matchMode: FilterMatchMode.BETWEEN },
mktval: { value: [minmktValue.value, maxmktValue.value], matchMode: FilterMatchMode.BETWEEN },
overall: { value: [minoverValue.value, maxoverValue.value], matchMode: FilterMatchMode.BETWEEN },
days: { value: [mindaysValue.value, maxdaysValue.value], matchMode: FilterMatchMode.BETWEEN },
date: { operator: FilterOperator.AND, constraints: [{ value: null, matchMode: FilterMatchMode.EQUALS }] },

};
};

watch(minQuantityValue, maxQuantityValue, initFilters);
watch(minavgValue,maxavgValue, initFilters);
watch(minltpValue,maxltpValue, initFilters);
watch(mininvValue,maxinvValue, initFilters);
watch(minoverValue,maxoverValue, initFilters);
watch(mindaysValue,maxdaysValue, initFilters);
watch(minmktValue,maxmktValue, initFilters);
const applyDateFilter = () => {
if (filters.value.date.constraints[0].value) {
let selectedDate = filters.value.date.constraints[0].value;
filters.value.date.constraints[0].value = formatDate(selectedDate);
}
};

const formatDate = (date) => {
if (!date) return null;
const d = new Date(date);
return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
};

initFilters()
onMounted(() => {
getdata();

});



const columns = ref([
{ field: 'stockname', header: 'STOCK NAME' },
{ field: 'quantity', header: 'QUANTITY' },
{ field: 'avgprice', header: 'AVG PRICE' },
{ field: 'ltp', header: 'LTP' },
{ field: 'invamt', header: 'INV' },
{ field: 'mktval', header: 'MKT' },
{ field: 'overall', header: 'OVERALL' },
{ field: 'days', header: 'DAYS' },
{ field: 'date', header: 'DATE' },

]);
//Initially select all columns except 'ltp', 'mktval', and 'date'
const selectedColumns = ref(columns.value.filter(col => !['ltp', 'mktval', 'date'].includes(col.field)));
const visibleColumns = ref(selectedColumns.value.map(col => col.field)); // Tracks visibility
const showReset = ref(true); // Ensure reset is visible as some columns are unchecked initially

const updateVisibleColumns = () => {
visibleColumns.value = selectedColumns.value.map(col => col.field);
showReset.value = selectedColumns.value.length < columns.value.length; // Show Reset only when some columns are unchecked
};

const resetColumns = () => {
selectedColumns.value = columns.value.slice(); // Reset to all columns selected
updateVisibleColumns(); // Ensure UI updates
};

watch(selectedColumns, updateVisibleColumns, { deep: true });

const dt = ref()
const exportCSV = () => {
dt.value.exportCSV();
};


const visibleRight = ref(false);
const stockname=ref('')
const dateval=ref('')
const quant=ref('')
const avg=ref('')
const ltp=ref('')
const invamt=ref('')
const mktval=ref('')
const overall=ref('')
const days=ref('')

const rightcanva =(dataval)=>{

visibleRight.value=true
stockname.value=dataval.stockname
dateval.value=dataval.date
quant.value=dataval.quantity
avg.value=dataval.avgprice
ltp.value=dataval.ltp
invamt.value=dataval.invamt
mktval.value=dataval.mktval
overall.value=dataval.overall
days.value=dataval.days
}

const proceedfun=async()=>{
const formdata=new FormData()
formdata.append('stockname', stockname.value)
formdata.append('date', dateval.value)
formdata.append('quantity', quant.value)
formdata.append('averageprice', avg.value)
formdata.append('ltp', ltp.value)
formdata.append('invamt', invamt.value)
formdata.append('mktval', mktval.value)
formdata.append('overall', overall.value)
formdata.append('days', days.value)
const api='https://fakestoreapi.com/products'
try {
const res = await fetch(api,{
method:'POST',
body:formdata
});
if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
const data = await res.json();
toast.add({ severity: 'success', summary: 'Success Message', detail: data.id, life: 3000 });
} catch (error) {
console.error("Error:", error.message);
}


}

const cancelfun=async()=>{

const formdata=new FormData()
formdata.append('stockname', stockname.value)
formdata.append('date', dateval.value)
formdata.append('quantity', quant.value)
formdata.append('averageprice', avg.value)
formdata.append('ltp', ltp.value)
formdata.append('invamt', invamt.value)
formdata.append('mktval', mktval.value)
formdata.append('overall', overall.value)
formdata.append('days', days.value)
const api='https://fakestoreapi.com/products'
try {
const res = await fetch(api,{
method:'POST',
body:formdata
});
if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
const data = await res.json();
toast.add({ severity: 'error', summary: 'Cancel Message', detail: data.id, life: 3000 });
} catch (error) {
console.error("Error:", error.message);
}
}
</script>

<style>
.left{
left:663% !important;
}
.p-checkbox-checked.p-variant-filled .p-checkbox-box{
    background-color: blue !important;
    border: blue !important;
  }
 
  .p-multiselect.p-variant-filled{
    background: none !important;
   
  }
  .p-multiselect-dropdown{
    border: 2px solid rgb(227, 227, 227);
    border-radius: 5px;
   
  }

  .p-multiselect-dropdown:hover{
    background-color: rgb(239, 239, 250);
  }
  .p-multiselect{
  
    box-shadow: none !important;
  }

</style>